#!/bin/sh

DIR='./'
FILE='*.h'
if (($# > 2)); then
    DIR=$1
    FILE=$2
    shift 2
elif (($# == 2)); then
    FILE=$1
    shift
elif (($# == 0)); then
    echo USAGE: $0 "[dir] [file_pattern] <class_pattern>"
    exit 1
fi
CLASS=$1

FILE=$(echo $FILE |gawk -F'|' '{file="-name "$1" -print"; for(i=2;i<=NF;i++) {file=file" -or -name "$i" -print";}} END{print file}')

#echo $FILE
#exit
GREP_RE="\(class\|struct\)[[:space:]]\+\([[:alnum:]_]\+[[:space:]]\+\)\?${CLASS}[[:space:]]*\([:{]\|$\)"
echo $GREP_RE
#exit
echo "find $DIR $FILE |xargs grep $GREP_RE -n --color |sed 's/:/ +/'"
find $DIR $FILE |xargs grep $GREP_RE -n --color |sed 's/:/ +/'
