#!/usr/bin/env nodejs
var path = require('path');
var url = require('url');
var threaded_http = require('./threaded_http.js');

var argv = process.argv;
var urlSrc = argv[2];
var nThreads = argv[3];
var pathDst = path.basename(url.parse(urlSrc).pathname);

threaded_http.threadedGet(urlSrc, pathDst, nThreads, null, 
    function (th) { th.on('thread_data', 
        function (i, chunk) {
            console.log("[INFO] file '%s': %d% (%dBytes)", th.destPath, parseInt(th.sizeGot * 100 / th.size), th.size);
        }).on('thread_finished', function (i) {
            console.log("[INFO] file '%s' download thread %d completed", th.destPath, i);
            nThreads --;
        }).on('end', function () {
            console.log("[INFO] file '%s' download completed", th.destPath);
            process.exit(0);
        });
    }
);

     
